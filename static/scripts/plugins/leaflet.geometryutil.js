var L=L||exports;!function(){"use strict";L.GeometryUtil=L.extend(L.GeometryUtil||{},{distance:function(t,e,n){return t.latLngToLayerPoint(e).distanceTo(t.latLngToLayerPoint(n))},distanceSegment:function(t,e,n,r){var o=t.latLngToLayerPoint(e),a=t.latLngToLayerPoint(n),i=t.latLngToLayerPoint(r);return L.LineUtil.pointToSegmentDistance(o,a,i)},belongsSegment:function(t,e,n,r){r=void 0===r?.2:r;var o=e.distanceTo(n);return(e.distanceTo(t)+t.distanceTo(n)-o)/o<r},length:function(t){var e=L.GeometryUtil.accumulatedLengths(t);return e.length>0?e[e.length-1]:0},accumulatedLengths:function(t){if("function"==typeof t.getLatLngs&&(t=t.getLatLngs()),0===t.length)return[];for(var e=0,n=[0],r=0,o=t.length-1;r<o;r++)e+=t[r].distanceTo(t[r+1]),n.push(e);return n},closestOnSegment:function(t,e,n,r){var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());var a=t.project(e,o),i=t.project(n,o),l=t.project(r,o),s=L.LineUtil.closestPointOnSegment(a,i,l);return t.unproject(s,o)},closest:function(t,e,n,r){"function"!=typeof e.getLatLngs&&(e=L.polyline(e));var o,a,i,l=e.getLatLngs().slice(0),s=1/0,c=null;if(r){for(o=0,a=l.length;o<a;o++){var g=l[o];(i=L.GeometryUtil.distance(t,n,g))<s&&(s=i,(c=g).distance=i)}return c}for(e instanceof L.Polygon&&l.push(l[0]),o=0,a=l.length;o<a-1;o++){var u=l[o],f=l[o+1];(i=L.GeometryUtil.distanceSegment(t,n,u,f))<=s&&(s=i,(c=L.GeometryUtil.closestOnSegment(t,n,u,f)).distance=i)}return c},closestLayer:function(t,e,n){for(var r=1/0,o=null,a=null,i=1/0,l=0,s=e.length;l<s;l++){var c=e[l];"function"==typeof c.getLatLng?(a=c.getLatLng(),i=L.GeometryUtil.distance(t,n,a)):(a=L.GeometryUtil.closest(t,c,n))&&(i=a.distance),i<r&&(r=i,o={layer:c,latlng:a,distance:i})}return o},closestLayerSnap:function(t,e,n,r,o){r="number"==typeof r?r:1/0,o="boolean"!=typeof o||o;var a=L.GeometryUtil.closestLayer(t,e,n);if(!a||a.distance>r)return null;if(o&&"function"==typeof a.layer.getLatLngs){var i=L.GeometryUtil.closest(t,a.layer,a.latlng,!0);i.distance<r&&(a.latlng=i,a.distance=L.GeometryUtil.distance(t,i,n))}return a},interpolateOnPointSegment:function(t,e,n){return L.point(t.x*(1-n)+n*e.x,t.y*(1-n)+n*e.y)},interpolateOnLine:function(t,e,n){var r=(e=e instanceof L.Polyline?e.getLatLngs():e).length;if(r<2)return null;if(0===n)return{latLng:e[0],predecessor:-1};if(1==n)return{latLng:e[e.length-1],predecessor:e.length-2};n=Math.max(Math.min(n,1),0);var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());for(var a=[],i=0,l=0;l<r;l++)a[l]=t.project(e[l],o),l>0&&(i+=a[l-1].distanceTo(a[l]));for(var s=i*n,c=a[0],g=a[1],u=0,f=c.distanceTo(g),y=1;y<r&&f<s;y++)c=g,u=f,g=a[y],f+=c.distanceTo(g);var m=f-u!=0?(s-u)/(f-u):0,p=L.GeometryUtil.interpolateOnPointSegment(c,g,m);return{latLng:t.unproject(p,o),predecessor:y-2}},locateOnLine:function(t,e,n){var r=e.getLatLngs();if(n.equals(r[0]))return 0;if(n.equals(r[r.length-1]))return 1;for(var o=L.GeometryUtil.closest(t,e,n,!1),a=L.GeometryUtil.accumulatedLengths(r),i=a[a.length-1],l=0,s=!1,c=0,g=r.length-1;c<g;c++){var u=r[c],f=r[c+1];if(l=a[c],L.GeometryUtil.belongsSegment(o,u,f)){l+=u.distanceTo(o),s=!0;break}}if(!s)throw"Could not interpolate "+n.toString()+" within "+e.toString();return l/i},reverse:function(t){return L.polyline(t.getLatLngs().slice(0).reverse())},extract:function(t,e,n,r){if(n>r)return L.GeometryUtil.extract(t,L.GeometryUtil.reverse(e),1-n,1-r);n=Math.max(Math.min(n,1),0),r=Math.max(Math.min(r,1),0);var o=e.getLatLngs(),a=L.GeometryUtil.interpolateOnLine(t,e,n),i=L.GeometryUtil.interpolateOnLine(t,e,r);if(n==r)return[L.GeometryUtil.interpolateOnLine(t,e,r).latLng];-1==a.predecessor&&(a.predecessor=0),-1==i.predecessor&&(i.predecessor=0);var l=o.slice(a.predecessor+1,i.predecessor+1);return l.unshift(a.latLng),l.push(i.latLng),l},isBefore:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs();return n[n.length-1].equals(r[0])},isAfter:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs();return n[0].equals(r[r.length-1])},startsAtExtremity:function(t,e){if(!e)return!1;var n=t.getLatLngs(),r=e.getLatLngs(),o=n[0];return o.equals(r[0])||o.equals(r[r.length-1])},computeAngle:function(t,e){return 180*Math.atan2(e.y-t.y,e.x-t.x)/Math.PI},computeSlope:function(t,e){var n=(e.y-t.y)/(e.x-t.x);return{a:n,b:t.y-n*t.x}},rotatePoint:function(t,e,n,r){var o=t.getMaxZoom();o===1/0&&(o=t.getZoom());var a=n*Math.PI/180,i=t.project(e,o),l=t.project(r,o),s=Math.cos(a)*(i.x-l.x)-Math.sin(a)*(i.y-l.y)+l.x,c=Math.sin(a)*(i.x-l.x)+Math.cos(a)*(i.y-l.y)+l.y;return t.unproject(new L.Point(s,c),o)}})}();